<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case Study: Working With Arab Barometer Surveys • retroharmonize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Case Study: Working With Arab Barometer Surveys">
<meta property="og:description" content="retroharmonize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">retroharmonize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/afrobarometer.html">Case Study: Working With Afrobarometer surveys</a>
    </li>
    <li>
      <a href="../articles/arabbarometer.html">Case Study: Working With Arab Barometer Surveys</a>
    </li>
    <li>
      <a href="../articles/eurobarometer.html">Case Study: Working with Eurobarometer surveys</a>
    </li>
    <li>
      <a href="../articles/harmonize_labels.html">Harmonize Value Labels</a>
    </li>
    <li>
      <a href="../articles/labelled_spss_survey.html">The labelled_spss_survey class</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rOpenGov/retroharmonize/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="arabbarometer_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Case Study: Working With Arab Barometer Surveys</h1>
                        <h4 class="author">Daniel Antal</h4>
                        <h4 class="author">Yousef Ibrahim</h4>
                        <h4 class="author">Ahmed Shaibani</h4>
            
            <h4 class="date">2021-06-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/master/vignettes/arabbarometer.Rmd"><code>vignettes/arabbarometer.Rmd</code></a></small>
      <div class="hidden name"><code>arabbarometer.Rmd</code></div>

    </div>

    
    
<p>The goal of this case article is to show how you can harmonize survey data from <a href="https://www.arabbarometer.org/">Arab Barometer</a> with the <a href="https://retroharmonize.dataobservatory.eu/">retroharmonize</a> R package. The Arab Barometer is a nonpartisan research network that provides insight into the social, political, and economic attitudes and values of ordinary citizens across the Arab world.</p>
<p>cross-national surveys on the example of the <a href="https://retroharmonize.dataobservatory.eu/articles/afrobarometer.html">Afrobarometer</a> and the <a href="https://retroharmonize.dataobservatory.eu/articles/eurobarometer.html">Eurobarometer</a>.</p>
<p>The authors of <code>retroharmonize</code>, and <a href="https://github.com/rOpenGov/retroharmonize/">rOpenGov</a> open source developer community are not affiliated with Arab Barometer. To fully reproduce this example, you must acquire the data files from them, which is free of charge. If you download and use the survey data, the Arab Barometer does not take any responsibility for the results of the analysis of the Arab Barometer data. All results published using the Arab Barometer data and related content are responsibility of the respective author.</p>
<p>Some code examples of this case study are not evaluated, because we want to avoid re-publishing the original microdata files from Arab Barometer. If you want to fully replicate these code examples, you need to access the data directly from the <a href="https://www.arabbarometer.org/survey-data/data-downloads/">arabbarometer.org website</a> after agreeing to their <a href="https://www.arabbarometer.org/policies/">policies</a> and filling out a short questionnaire.</p>
<p>The files are stored on the website in <code>.zip</code> format, which may be extracted to folders. We assume that you extracted and copied all <code>.sav</code> files into a single folder that we will call in this vignette the <code>arabbarometer_dir</code>. Define your own <code>arabbarometer_dir</code> with <code><a href="https://rdrr.io/r/base/file.path.html">file.path()</a></code> in your own system.</p>
<table class="table">
<thead><tr class="header">
<th>File name</th>
<th>Wave</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ABI_English.sav</td>
<td>Arab Barometer Wave I</td>
</tr>
<tr class="even">
<td>ABII_English.sav</td>
<td>Arab Barometer Wave II</td>
</tr>
<tr class="odd">
<td>ABIII_English.sav</td>
<td>Arab Barometer Wave III</td>
</tr>
<tr class="even">
<td>ABIV_English.sav</td>
<td>Arab Barometer Wave IV</td>
</tr>
<tr class="odd">
<td>AB-WaveV-EN.sav</td>
<td>Arab Barometer Wave V</td>
</tr>
</tbody>
</table>
<p>In this case study, we will compare how people evaluated their parliamentary elections in 2010/2011, 2012/2014 and in 2016/17. To make this comparison, we must organize the <code>Arab Barometer Wave II</code>, <code>Arab Barometer Wave III</code> and <code>Arab Barometer Wave IV</code> data files into a single, tidy, data frame with a consistent labelling of valid and missing values.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">'vignettes'</span>, <span class="st">'arabb-comparison-select-country-chart.png'</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="arabb-comparison-select-country-chart.png" width="85%" style="display: block; margin: auto;"></p>
<div id="importing-arab-barometer-files" class="section level2">
<h2 class="hasAnchor">
<a href="#importing-arab-barometer-files" class="anchor"></a>Importing Arab Barometer Files</h2>
<p>We start by importing the Arab Barometer files. The following chunk is not evaluated, and it contains all the 5 waves, not only the two selected waves for this tutorial. if you want to re-run this tutorial, you need to define your <code>arabbarometer_dir</code> and download the Arab Barometer files there. Alternatively, you can load the pre-saved results of the first steps in the first, <code>vignette-setup</code> chunk, in this case can start evaluating the R code chunks from <code>document-merged-ab</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### use here your own &lt;arabbarometer_dir&gt; directory</span>
<span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="va">arabbarometer_dir</span>, pattern <span class="op">=</span> <span class="st">"sav$"</span><span class="op">)</span>
<span class="va">arabbarometer_rounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="va">arabbarometer_dir</span>, <span class="va">ab</span><span class="op">)</span>
<span class="va">arab_waves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span><span class="op">(</span><span class="va">arabbarometer_rounds</span>, .f<span class="op">=</span><span class="st">'read_spss'</span><span class="op">)</span></code></pre></div>
<p>we appended meaningful identifiers to the file names as follows (you must follow the ordering of your files in your own <code>arabbarometer_dir</code> dir):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In the vignette this is pre-loaded.</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">arab_waves</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Arab_Barometer_5"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">arab_waves</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,<span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Arab_Barometer_1"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">arab_waves</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,<span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Arab_Barometer_2"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">arab_waves</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,<span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Arab_Barometer_3"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">arab_waves</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,<span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Arab_Barometer_4"</span></code></pre></div>
<p>We use <code><a href="../reference/document_waves.html">document_waves()</a></code>to see the primary descriptive information of our survey wave (one harmonized survey set) files. Visually check that the file names correspond with the meaningful IDs that you gave to each survey wave, i.e., <code>Arab_Barometer_1</code> corresponds with <code>ABI_English.sav</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In the vignette this is pre-loaded.</span>
<span class="va">documented_arab_waves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/document_waves.html">document_waves</a></span><span class="op">(</span><span class="va">arab_waves</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">documented_arab_waves</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt;   id               filename           ncol  nrow object_size</span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;             &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Arab_Barometer_5 AB-WaveV-EN.sav     348 26780    78131600</span>
<span class="co">#&gt; 2 Arab_Barometer_1 ABI_English.sav     182  7337    12089512</span>
<span class="co">#&gt; 3 Arab_Barometer_2 ABII_English.sav    469 12782    51603152</span>
<span class="co">#&gt; 4 Arab_Barometer_3 ABIII_English.sav   297 14809    37826816</span>
<span class="co">#&gt; 5 Arab_Barometer_4 ABIV_English.sav    291  9000    23315888</span></code></pre></div>
<p>We obtained 5 nested lists in the <code>arab_waves</code> list, each of them containing data of one Arab Barometer survey wave (the same surveys taken roughly at the same time, and with the same questions in different languages and countries.). To create longitudinal tables, i.e., join several survey waves into a single table, it is important to review the methodology of each round of Arabbarometer’s surveys, its structure, modifications, and changes in topics of interest.</p>
<div id="joint-metadata-creation" class="section level3">
<h3 class="hasAnchor">
<a href="#joint-metadata-creation" class="anchor"></a>Joint Metadata Creation</h3>
<p>In this step, we build a comprehensive metadata table that maps information about variable names and labels of the survey data. Each row in the table below refers to a different variable in the survey data file. This is accomplished using the <code><a href="../reference/metadata_create.html">metadata_create()</a></code> function, which collects metadata from survey data files, normalizes variable labels, and defines the valid and missing value ranges, codes, and labels.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In the vignette this is pre-loaded.</span>
<span class="va">arabbarometer_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span> X <span class="op">=</span> <span class="va">arab_waves</span>, FUN <span class="op">=</span> <span class="va">metadata_create</span><span class="op">)</span>
<span class="va">arabbarometer_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">arabbarometer_metadata</span><span class="op">)</span></code></pre></div>
<p>Let’s randomly review some metadata:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>
<span class="va">arabbarometer_metadata</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"class_orig"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>
<span class="co">#&gt;                 id var_name_orig</span>
<span class="co">#&gt; 1 Arab_Barometer_2         q7112</span>
<span class="co">#&gt; 2 Arab_Barometer_5        Q521_1</span>
<span class="co">#&gt; 3 Arab_Barometer_4    aid1b1lang</span>
<span class="co">#&gt; 4 Arab_Barometer_1         q2572</span>
<span class="co">#&gt; 5 Arab_Barometer_2         q5164</span>
<span class="co">#&gt; 6 Arab_Barometer_2         eg802</span>
<span class="co">#&gt;                                                                                                                                                 label_orig</span>
<span class="co">#&gt; 1 q7112 to what extent do you agree or disagree with the following statements 2 in order to eliminate global terrorism, the palestine issue must be solved</span>
<span class="co">#&gt; 2                                                                                                                   guaranteed freedoms opinion expression</span>
<span class="co">#&gt; 3                                                                                                       aid1b1 respondent participated in language program</span>
<span class="co">#&gt; 4                                                                                     q257 2 can you remember the name of the speaker leader of parliament</span>
<span class="co">#&gt; 5 q5164 to what extent do you agree or disagree with the following statements 4 a democratic system may have problems, yet it is better than other systems</span>
<span class="co">#&gt; 6                                eg802 did you participate in the protests against former president hosni mubarak between january 25 and february 11, 2011</span>
<span class="co">#&gt;                labels        valid_labels na_labels na_range n_labels</span>
<span class="co">#&gt; 1 0, 1, 2, 3, 4, 8, 9 0, 1, 2, 3, 4, 8, 9                 NA        7</span>
<span class="co">#&gt; 2  1, 2, 3, 4, 98, 99  1, 2, 3, 4, 98, 99                 NA        6</span>
<span class="co">#&gt; 3                0, 1                0, 1                 NA        2</span>
<span class="co">#&gt; 4    1, 2, 97, 98, 99    1, 2, 97, 98, 99                 NA        5</span>
<span class="co">#&gt; 5 0, 1, 2, 3, 4, 8, 9 0, 1, 2, 3, 4, 8, 9                 NA        7</span>
<span class="co">#&gt; 6       0, 1, 2, 8, 9       0, 1, 2, 8, 9                 NA        5</span>
<span class="co">#&gt;   n_valid_labels n_na_labels</span>
<span class="co">#&gt; 1              7           0</span>
<span class="co">#&gt; 2              6           0</span>
<span class="co">#&gt; 3              2           0</span>
<span class="co">#&gt; 4              5           0</span>
<span class="co">#&gt; 5              7           0</span>
<span class="co">#&gt; 6              5           0</span></code></pre></div>
<p>We select from the metadata file <code>rowid</code> as the unique observation identifier, and some auxiliary variables: <code>date</code> with the interview date,the <code>COUNTRY</code> containing country where the interview was conducted, and <code>wt</code> as the weighting factor, and some “real” survey questions. The countries in the Arab Barometer datasets are countries from the Middle East and North Africa (MENA) region with a significant Arab speaking population. The data does not contain all the MENA countries, for example, Palestine is present in the dataset, but Israel is not.</p>
<p>The metadata table also helps you to identify survey items of interest; in our case, we chose <em>Election, parliamentary</em>, and <em>Election</em> to fork an exact question about parliamentary election, which is <code>How would you evaluate the last parliamentary election?</code></p>
</div>
</div>
<div id="retrospective-survey-harmonization" class="section level2">
<h2 class="hasAnchor">
<a href="#retrospective-survey-harmonization" class="anchor"></a>Retrospective Survey Harmonization</h2>
<p>Retrospective survey harmonization has two steps: variable harmonization and label harmonization.</p>
<div id="harmonizing-the-variable-names" class="section level3">
<h3 class="hasAnchor">
<a href="#harmonizing-the-variable-names" class="anchor"></a>Harmonizing the variable names</h3>
<p>We start with the variable harmonization process.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">to_harmonize_elections</span> <span class="op">&lt;-</span> <span class="va">arabbarometer_metadata</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowid"</span>, <span class="st">"country"</span>,<span class="st">"date"</span>, <span class="st">"wt"</span><span class="op">)</span><span class="op">|</span>
           <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"how would you evaluate the last parliamentary"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>var_label <span class="op">=</span> <span class="fu"><a href="../reference/label_normalize.html">var_label_normalize</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>var_label <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"country"</span> <span class="op">~</span> <span class="st">"Country"</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span>   <span class="op">~</span> <span class="st">"Unique ID AB English"</span>, <span class="co"># in pdf Unique ID AB English</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"date"</span>    <span class="op">~</span> <span class="st">"Date_of_interview"</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"wt"</span>      <span class="op">~</span> <span class="st">"Weight"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">" Evaluation in the last parliamentary elections"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> <span class="op">(</span> var_name <span class="op">=</span> <span class="fu"><a href="../reference/label_normalize.html">var_label_normalize</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">var_label</span><span class="op">)</span> <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span> <span class="co"># Let's see the same random example:</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="va">to_harmonize_elections</span><span class="op">%&gt;%</span> 
       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"var_name"</span>, <span class="st">"var_label"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt;                  id                                       var_name</span>
<span class="co">#&gt; 1  Arab_Barometer_2                           unique id ab english</span>
<span class="co">#&gt; 2  Arab_Barometer_1                                        country</span>
<span class="co">#&gt; 3  Arab_Barometer_3                                         weight</span>
<span class="co">#&gt; 4  Arab_Barometer_2                                         weight</span>
<span class="co">#&gt; 5  Arab_Barometer_4 evaluation in the last parliamentary elections</span>
<span class="co">#&gt; 6  Arab_Barometer_3                                        country</span>
<span class="co">#&gt; 7  Arab_Barometer_5                              date_of_interview</span>
<span class="co">#&gt; 8  Arab_Barometer_4                                         weight</span>
<span class="co">#&gt; 9  Arab_Barometer_4                                        country</span>
<span class="co">#&gt; 10 Arab_Barometer_3                           unique id ab english</span>
<span class="co">#&gt;                                          var_label</span>
<span class="co">#&gt; 1                             Unique ID AB English</span>
<span class="co">#&gt; 2                                          Country</span>
<span class="co">#&gt; 3                                           Weight</span>
<span class="co">#&gt; 4                                           Weight</span>
<span class="co">#&gt; 5   Evaluation in the last parliamentary elections</span>
<span class="co">#&gt; 6                                          Country</span>
<span class="co">#&gt; 7                                Date_of_interview</span>
<span class="co">#&gt; 8                                           Weight</span>
<span class="co">#&gt; 9                                          Country</span>
<span class="co">#&gt; 10                            Unique ID AB English</span></code></pre></div>
<ul>
<li>Variable harmonization means that the date of the interview should be called exactly the same way in each survey table, i.e. not <code>date</code> and <code>date_of_interview</code>, only <code>date_of_interview</code>. The auxiliary and demography variables appear to be relatively well harmonized in the Arab Barometer, but the other survey items will require more work.</li>
<li>Label harmonization means that the label for <em>Algeria</em> in the <code>country</code> variable must be a single value, for example, <code>Algeria</code>, instead of <code>Algeria</code>, <code>algeria</code>, <code>1. Algeria</code>.</li>
</ul>
<p>In this case, the variable name harmonization is a simple task. The names need a bit of normalization for programmatic use.</p>
<p>The function <code><a href="../reference/merge_waves.html">merge_waves()</a></code> harmonizes the variable names, the variable labels, the survey identifiers, and returns a list of surveys (of <code>class survey()</code>.) The parameter <em>var_harmonization</em> must be a list or a data frame that contains at least the original file name (<code>filename</code>), original variable names (<code>var_name_orig</code>), the new variable names (<code>var_name</code>) and their labels (<code>var_label</code>), so that the function correctly makes the harmonization steps.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In the vignette this is pre-loaded.</span>
<span class="va">merged_ab_elections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_waves.html">merge_waves</a></span><span class="op">(</span>
  waves <span class="op">=</span> <span class="va">arab_waves</span>, 
  var_harmonization <span class="op">=</span> <span class="va">to_harmonize_elections</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/document_waves.html">document_waves</a></span><span class="op">(</span><span class="va">merged_ab_elections</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt;   id               filename           ncol  nrow object_size</span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;             &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Arab_Barometer_5 AB-WaveV-EN.sav       4 26780     2991624</span>
<span class="co">#&gt; 2 Arab_Barometer_1 ABI_English.sav       2  7337      694064</span>
<span class="co">#&gt; 3 Arab_Barometer_2 ABII_English.sav      4 12782     1443896</span>
<span class="co">#&gt; 4 Arab_Barometer_3 ABIII_English.sav     5 14809     1790104</span>
<span class="co">#&gt; 5 Arab_Barometer_4 ABIV_English.sav      4  9000     1017088</span></code></pre></div>
<p>Let’s take a look at the variables:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span><span class="va">merged_ab_elections</span>, <span class="va">names</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "unique id ab english" "country"              "weight"              </span>
<span class="co">#&gt; [4] "date_of_interview"   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "unique id ab english" "country"             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "unique id ab english"                          </span>
<span class="co">#&gt; [2] "country"                                       </span>
<span class="co">#&gt; [3] "evaluation in the last parliamentary elections"</span>
<span class="co">#&gt; [4] "weight"                                        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] "unique id ab english"                          </span>
<span class="co">#&gt; [2] "country"                                       </span>
<span class="co">#&gt; [3] "date_of_interview"                             </span>
<span class="co">#&gt; [4] "weight"                                        </span>
<span class="co">#&gt; [5] "evaluation in the last parliamentary elections"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] "unique id ab english"                          </span>
<span class="co">#&gt; [2] "country"                                       </span>
<span class="co">#&gt; [3] "weight"                                        </span>
<span class="co">#&gt; [4] "evaluation in the last parliamentary elections"</span></code></pre></div>
<p>The variable harmonization took place, but the variable names are not very practical for programmatic use. We apply snakecase variable naming:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Tazinho/snakecase">snakecase</a></span><span class="op">)</span>
<span class="va">merged_ab_elections</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
  <span class="va">merged_ab_elections</span>, 
  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span> <span class="op">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_all</a></span><span class="op">(</span><span class="fu">snakecase</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/snakecase/man/caseconverter.html">to_snake_case</a></span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>Now the variable names are ready to use in the programmatic way:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">merged_ab_elections</span>, <span class="va">names</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "unique_id_ab_english" "country"              "weight"              </span>
<span class="co">#&gt; [4] "date_of_interview"   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "unique_id_ab_english" "country"             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "unique_id_ab_english"                          </span>
<span class="co">#&gt; [2] "country"                                       </span>
<span class="co">#&gt; [3] "evaluation_in_the_last_parliamentary_elections"</span>
<span class="co">#&gt; [4] "weight"                                        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] "unique_id_ab_english"                          </span>
<span class="co">#&gt; [2] "country"                                       </span>
<span class="co">#&gt; [3] "date_of_interview"                             </span>
<span class="co">#&gt; [4] "weight"                                        </span>
<span class="co">#&gt; [5] "evaluation_in_the_last_parliamentary_elections"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; [1] "unique_id_ab_english"                          </span>
<span class="co">#&gt; [2] "country"                                       </span>
<span class="co">#&gt; [3] "weight"                                        </span>
<span class="co">#&gt; [4] "evaluation_in_the_last_parliamentary_elections"</span></code></pre></div>
<p>The <code>merged_ab_elections</code> is a list, which nests the individual, subsetted surveys. We use the nested list form, because a critical step is missing: the survey have differing number of columns, so they cannot be joined into a long-form, tidy data frame. Let’s remove the nonessential variables, and remove the survey waves that do not contain our variable of interest.</p>
<p>In our case, we decided to: - omit completely both waves 1 and 5, because none of them has our key variable <code>Parliamentary Election Evaluation</code>; - omit <code>date of interview</code> as it is missing in both waves (rounds) 2 and 4.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ab_elections</span> <span class="op">&lt;-</span> <span class="va">merged_ab_elections</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span> <span class="va">ab_elections</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>  <span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">id</span> <span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "Arab_Barometer_2"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "Arab_Barometer_3"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "Arab_Barometer_4"</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ab_elections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ab_elections</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="st">"date_of_interview"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">x</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">date_of_interview</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/document_waves.html">document_waves</a></span><span class="op">(</span><span class="va">ab_elections</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   id               filename           ncol  nrow object_size</span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;             &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Arab_Barometer_2 ABII_English.sav      4 12782     1443896</span>
<span class="co">#&gt; 2 Arab_Barometer_3 ABIII_English.sav     4 14809     1670608</span>
<span class="co">#&gt; 3 Arab_Barometer_4 ABIV_English.sav      4  9000     1017088</span></code></pre></div>
</div>
<div id="variable-label-harmonization" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-label-harmonization" class="anchor"></a>Variable Label Harmonization</h3>
<p>The R language uses special NA values for missing values. These are differently encoded in SPSS, and in various survey programs unfortunately are not always consistently used. Compared to our Eurobarometer and Afrobarometer use cases, the Arab Barometer needs particularly lot of harmonization, because - The published Arab Barometer files do not contain either missing range, nor the explicitly stated missing cases, and the values that refer to various missing cases are mixed with valid values; - The missing cases, like the valid cases, are labelled inconsistently.</p>
<p>Our variable label harmonization therefore takes two steps: carefully labelling and removing the missing cases from the valid range, and then harmonizing the valid value labels.</p>
<p>Arabbarometer’s SPSS files use various missing value categories, we must carefully harmonize them, too. The entire value range is the following:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/collect_val_labels.html">collect_val_labels</a></span><span class="op">(</span>
  <span class="va">to_harmonize_elections</span> <span class="op">%&gt;%</span> 
     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"evaluation in the last parliamentary elections"</span>, 
                  <span class="va">.data</span><span class="op">$</span><span class="va">var_name</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="co">#&gt;  [1] "0. missing"                                          </span>
<span class="co">#&gt;  [2] "1. they were completely free and fair"               </span>
<span class="co">#&gt;  [3] "2. they were free and fair, with some minor problems"</span>
<span class="co">#&gt;  [4] "3. they were free and fair, with some major problems"</span>
<span class="co">#&gt;  [5] "4. they were not free and fair"                      </span>
<span class="co">#&gt;  [6] "8. i don't know"                                     </span>
<span class="co">#&gt;  [7] "9. declined to answer"                               </span>
<span class="co">#&gt;  [8] "Missing"                                             </span>
<span class="co">#&gt;  [9] "They were completely free and fair"                  </span>
<span class="co">#&gt; [10] "They were free and fair, with some minor breaches"   </span>
<span class="co">#&gt; [11] "They were free and fair, with some major breaches"   </span>
<span class="co">#&gt; [12] "They were not free and fair"                         </span>
<span class="co">#&gt; [13] "Don't know"                                          </span>
<span class="co">#&gt; [14] "Refuse"                                              </span>
<span class="co">#&gt; [15] "Completely free and fair"                            </span>
<span class="co">#&gt; [16] "Free and fair, but with minor problems"              </span>
<span class="co">#&gt; [17] "Free and fair, with major problems"                  </span>
<span class="co">#&gt; [18] "Not free or fair"                                    </span>
<span class="co">#&gt; [19] "Don't know (Do not read)"                            </span>
<span class="co">#&gt; [20] "Decline to answer (Do not read)"</span></code></pre></div>
<p>For example, <code>Refuse</code> and <code>Decline to answer (Do not read)</code> are categories when the interviewee refused to form an opinion. This is a different case from <code>Missing</code>: in Saudi Arabia, there were not parliamentary elections, therefore the question was not asked from interviewees in this country.</p>
<p>The question of interest <code>How would you evaluate the last parliamentary election?</code> is described as a closed form survey questions where answers are predetermined and the respondents chose one of the answer options. This question has four-point ordinal scales, therefore, data is best to analyzed in an ordinal representation that does not assume equidistant values (i.e., as factors.)</p>
<p>We created the following retrospective labelling and coding:</p>
<ol style="list-style-type: decimal">
<li>Answer with 1 corresponding to the <code>free_and_fair</code> (highest democratic election process).</li>
<li>Answer with 2 corresponding to <code>some_minor_problems</code>.</li>
<li>Answer with 3 corresponding to <code>some_major_problems</code>.</li>
<li>Answer with 4 corresponding to <code>not_free</code>(lowest democratic election process).</li>
<li>We use three types of missing value categories: <code>Do not know</code>, <code>Declined</code> and <code>Missing</code>.</li>
</ol>
<p>The harmonization function from the <code><a href="../reference/harmonize_values.html">harmonize_values()</a></code> is a prototype function. We could call it directly, but instead we create <code>harmonize_arabb_eval()</code> to avoid the complicated parameterization.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonize_arabb_eval</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">label_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(\\d\\.\\s)?(\\w+\\s\\w+\\s)?([c|C]ompletely free and fair)"</span>,
             <span class="st">"(.+)(but)?\\s?(with)\\s(some)?\\s{0,}(minor\\s\\w+)"</span>,
             <span class="st">"(.+)(but)?\\s?(with)\\s(some)?\\s{0,}(major\\s\\w+)"</span>,
             <span class="st">"(.+)?([n|N]ot\\sfree\\s\\w+\\s\\w+)"</span>,
             <span class="st">"((\\d.\\s{0,})?\\si\\s)?([d|D]on.t\\sknow)(\\s\\(Do\\snot\\sread\\))?"</span>, 
             <span class="st">"[R|r]efuse"</span>, 
             <span class="st">"(\\d.\\s)?[d|D]ecline[d]?(\\s\\w+\\s\\w+)(\\s.Do not read.)?"</span>,
             <span class="st">"(\\d.\\s)?[m|M]issing"</span><span class="op">)</span>,
    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"free_and_fair"</span>, 
           <span class="st">"some_minor_problems"</span>,
           <span class="st">"some_major_problems"</span>,
           <span class="st">"not_free"</span>,
           <span class="st">"do_not_know"</span>,<span class="st">"declined"</span>,<span class="st">"declined"</span>,<span class="st">"missing"</span><span class="op">)</span>,
    numeric_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">99997</span>,<span class="fl">99998</span>,<span class="fl">99998</span>,<span class="fl">99999</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="../reference/harmonize_values.html">harmonize_values</a></span><span class="op">(</span><span class="va">x</span>, harmonize_labels <span class="op">=</span> <span class="va">label_list</span>, 
                   na_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"do_not_know"</span><span class="op">=</span> <span class="fl">99997</span>,
                                 <span class="st">"declined"</span><span class="op">=</span><span class="fl">99998</span>,
                                 <span class="st">"missing"</span><span class="op">=</span><span class="fl">99999</span>
                   <span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The problem is that the numeric codes are not only used for the evaluation question, but also for country names. Beware not to apply the election evaluation code tabel to the country names!</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_evaluations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/harmonize_waves.html">harmonize_waves</a></span><span class="op">(</span> 
  waves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span> <span class="va">ab_elections</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">%&gt;%</span> 
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="op">-</span><span class="va">.data</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span>, 
  .f <span class="op">=</span><span class="va">harmonize_arabb_eval</span> <span class="op">)</span></code></pre></div>
<p>There is a bit of a work with the country variable, too, but this variable has no missing cases, and instead of creating a labelling, we will convert them into factors after cleaning. We only show a few examples of the labelling issues:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect_val_labels.html">collect_val_labels</a></span> <span class="op">(</span><span class="va">to_harmonize_elections</span> <span class="op">%&gt;%</span> 
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> <span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">var_name</span> <span class="op">==</span> <span class="st">"country"</span><span class="op">)</span><span class="op">)</span> 

<span class="va">country_labels</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"lgeria|orocco|oman"</span> , <span class="va">country_labels</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] "Algeria"     "Morocco"     "algeria"     "morocco"     "1. Algeria" </span>
<span class="co">#&gt; [6] "13. morocco" "14. oman"</span></code></pre></div>
<p>Do not forget that our imported surveys use <a href="https://retroharmonize.dataobservatory.eu/articles/labelled_spss_survey.html">our special vector class</a> to contain all <em>metadata</em> information that could be saved from the SPSS files. The base R <code>as.character</code> and <code>as.factor</code> methods should be avoided, because they do not understand the SPSS labels. Use the <code><a href="../reference/labelled_spss_survey.html">as_character()</a></code> and <code>as_factor</code> methods clean the country names. We could use <code><a href="../reference/harmonize_values.html">harmonize_values()</a></code>,` too, but that would be a lot of work, because there are a lot of country labels present. So we only retain a factor representation of the country names, without keeping their labelling history.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">normalize_country_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> 
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\d{1,}\\.\\s?"</span>,<span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="../reference/labelled_spss_survey.html">as_character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, which <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span>
  <span class="fu"><a href="../reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="fu">snakecase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/snakecase/man/caseconverter.html">to_title_case</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonize_countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span> <span class="va">ab_elections</span>, 
                                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">%&gt;%</span> 
                                          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="va">.data</span><span class="op">$</span><span class="va">evaluation_in_the_last_parliamentary_elections</span><span class="op">)</span>
                                <span class="op">)</span>
<span class="va">harmonized_countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> <span class="op">(</span> <span class="va">harmonize_countries</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">%&gt;%</span>
                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> <span class="op">(</span> country <span class="op">=</span> <span class="fu">normalize_country_names</span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="st">"date_of_interview"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">harmonized_countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span> <span class="op">(</span><span class="va">rbind</span>, <span class="va">harmonized_countries</span><span class="op">)</span></code></pre></div>
<p>Let’s see if there is any further work to do!</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">harmonized_countries</span><span class="op">)</span>
<span class="co">#&gt;  unique_id_ab_english      country          weight        </span>
<span class="co">#&gt;  Length:36591         Jordan   : 4483   Min.   : 0.02837  </span>
<span class="co">#&gt;  Class :character     Lebanon  : 4087   1st Qu.: 0.70908  </span>
<span class="co">#&gt;  Mode  :character     Algeria  : 3636   Median : 0.96349  </span>
<span class="co">#&gt;                       Egypt    : 3615   Mean   : 0.99928  </span>
<span class="co">#&gt;                       Palestine: 3600   3rd Qu.: 1.17818  </span>
<span class="co">#&gt;                       Tunisia  : 3595   Max.   :16.48268  </span>
<span class="co">#&gt;                       (Other)  :13575   NA's   :1</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">harmonized_evaluations</span><span class="op">)</span>
<span class="co">#&gt;  unique_id_ab_english     weight        </span>
<span class="co">#&gt;  Length:36591         Min.   : 0.02837  </span>
<span class="co">#&gt;  Class :character     1st Qu.: 0.70908  </span>
<span class="co">#&gt;  Mode  :character     Median : 0.96349  </span>
<span class="co">#&gt;                       Mean   : 0.99928  </span>
<span class="co">#&gt;                       3rd Qu.: 1.17818  </span>
<span class="co">#&gt;                       Max.   :16.48268  </span>
<span class="co">#&gt;                       NA's   :1         </span>
<span class="co">#&gt;  evaluation_in_the_last_parliamentary_elections</span>
<span class="co">#&gt;  Min.   :    0                                 </span>
<span class="co">#&gt;  1st Qu.:    0                                 </span>
<span class="co">#&gt;  Median :    2                                 </span>
<span class="co">#&gt;  Mean   :15099                                 </span>
<span class="co">#&gt;  3rd Qu.:    3                                 </span>
<span class="co">#&gt;  Max.   :99999                                 </span>
<span class="co">#&gt;  NA's   :2004</span></code></pre></div>
<p>We see a missing weight, and we will impute 1 for this particular value, so that we can use weighted averaging in the numerical representation of our data.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_ab_dataset</span> <span class="op">&lt;-</span> <span class="va">harmonized_countries</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">harmonized_evaluations</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unique_id_ab_english"</span>, <span class="st">"weight"</span><span class="op">)</span> <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span> <span class="op">(</span> eval_parl <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">evaluation_in_the_last_parliamentary_elections</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> <span class="op">(</span> 
    wave <span class="op">=</span> <span class="fu"><a href="../reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*(\\b[A-Z0-9]+).*"</span>, <span class="st">"\\1"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">unique_id_ab_english</span><span class="op">)</span><span class="op">)</span>,
    weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">.data</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>, 
    eval_parl <span class="op">=</span> <span class="fu"><a href="../reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span><span class="op">)</span>, 
    country <span class="op">=</span> <span class="fu"><a href="../reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">country</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">harmonized_ab_dataset</span><span class="op">)</span>
<span class="co">#&gt;  unique_id_ab_english      country          weight        </span>
<span class="co">#&gt;  Length:36591         Jordan   : 4483   Min.   : 0.02837  </span>
<span class="co">#&gt;  Class :character     Lebanon  : 4087   1st Qu.: 0.70908  </span>
<span class="co">#&gt;  Mode  :character     Algeria  : 3636   Median : 0.96349  </span>
<span class="co">#&gt;                       Egypt    : 3615   Mean   : 0.99928  </span>
<span class="co">#&gt;                       Palestine: 3600   3rd Qu.: 1.17818  </span>
<span class="co">#&gt;                       Tunisia  : 3595   Max.   :16.48268  </span>
<span class="co">#&gt;                       (Other)  :13575                     </span>
<span class="co">#&gt;                eval_parl       wave      </span>
<span class="co">#&gt;  not_free           :9453   ABII :12782  </span>
<span class="co">#&gt;  some_minor_problems:8141   ABIII:14809  </span>
<span class="co">#&gt;  free_and_fair      :7434   ABIV : 9000  </span>
<span class="co">#&gt;  do_not_know        :4954                </span>
<span class="co">#&gt;  some_major_problems:4337                </span>
<span class="co">#&gt;  (Other)            : 268                </span>
<span class="co">#&gt;  NA's               :2004</span></code></pre></div>
</div>
<div id="categorical-and-numeric-coding" class="section level3">
<h3 class="hasAnchor">
<a href="#categorical-and-numeric-coding" class="anchor"></a>Categorical And Numeric Coding</h3>
<p>The labeled survey data was stored in <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> vectors, which is a complex class that retains metadata for reproducibility, but most statistical packages work with numeric or categorical (factor) data. The data can be converted to any of these, but you should use the methods of <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> for this purpose, i.e., <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code> or <code><a href="../reference/as_factor.html">as_factor()</a></code>. (See more why you should not fall back on the more generic as.factor() or as.numeric() methods in The <a href="https://retroharmonize.dataobservatory.eu/articles/labelled_spss_survey.html">labelled_spss_survey class vignette</a>.)</p>
<p>Due to the categorical format of the question of MENA parliamentary election evaluation in the Arab Barometer survey rounds, we decided to present the election variable in its <em>categorical</em> format. We show the unweighted tallies for each evaluation category, and a weighted sum, which the rounded number of the category counts multiplied by the respondent’s post-stratification weight.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">categorical_summary</span> <span class="op">&lt;-</span> <span class="va">harmonized_ab_dataset</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unique_id_ab_english"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">country</span>, <span class="va">.data</span><span class="op">$</span><span class="va">wave</span>, <span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span> <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span> <span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
             weighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">weight</span>, <span class="fl">0</span><span class="op">)</span>
             <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>
<span class="va">categorical_summary</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 12 x 5</span>
<span class="co">#&gt;    country wave  eval_parl               n weighted</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;               &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Sudan   ABIII not_free              360      176</span>
<span class="co">#&gt;  2 Lebanon ABIV  some_minor_problems   412      341</span>
<span class="co">#&gt;  3 Lebanon ABIII free_and_fair         271      556</span>
<span class="co">#&gt;  4 Morocco ABIV  some_minor_problems   386      362</span>
<span class="co">#&gt;  5 Lebanon ABIV  some_minor_problems   412      377</span>
<span class="co">#&gt;  6 Lebanon ABII  some_major_problems   268      242</span>
<span class="co">#&gt;  7 Lebanon ABIII not_free              272      268</span>
<span class="co">#&gt;  8 Tunisia ABIV  free_and_fair         302      296</span>
<span class="co">#&gt;  9 Algeria ABII  do_not_know           407      326</span>
<span class="co">#&gt; 10 Morocco ABIII some_minor_problems   328      375</span>
<span class="co">#&gt; 11 Jordan  ABIII free_and_fair         172      410</span>
<span class="co">#&gt; 12 Sudan   ABIII not_free              360      439</span></code></pre></div>
<p>The output as shown in the table above indicates the number of valuations given by interviewees to the election evaluation question, by country and by survey wave. In the table below (which we only print in part), we assign numeric values to the evaluation categories. To recall our simple coding: - <code>3</code> = Free and fair - <code>2</code> = Some minor problems - <code>1</code> = Some major problems - <code>0</code> = Not free.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">numeric_summary</span> <span class="op">&lt;-</span> <span class="va">harmonized_ab_dataset</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unique_id_ab_english"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> <span class="op">(</span> eval_parl <span class="op">=</span> <span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">country</span>, <span class="va">.data</span><span class="op">$</span><span class="va">wave</span> <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span> <span class="op">(</span>
    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span>, w <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,
    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; `summarise()` has grouped output by 'country'. You can override using the `.groups` argument.</span></code></pre></div>
<p>In the numeric summary we show the weighted average valuations and the unweighted, typical values. These correspond with highest tallies for the categorical (and unweighted) counts.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>
<span class="va">numeric_summary</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 12 x 4</span>
<span class="co">#&gt;    country wave   mean median</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Iraq    ABII   2.53      2</span>
<span class="co">#&gt;  2 Egypt   ABIV   3.38      4</span>
<span class="co">#&gt;  3 Lebanon ABIV  NA        NA</span>
<span class="co">#&gt;  4 Kuwait  ABIII  3.27      3</span>
<span class="co">#&gt;  5 Morocco ABIV   3.45      3</span>
<span class="co">#&gt;  6 Lebanon ABII   2.69      3</span>
<span class="co">#&gt;  7 Sudan   ABIII  2.59      3</span>
<span class="co">#&gt;  8 Morocco ABIII  2.82      3</span>
<span class="co">#&gt;  9 Tunisia ABIII  3.59      4</span>
<span class="co">#&gt; 10 Tunisia ABII   1.48      1</span>
<span class="co">#&gt; 11 Libya   ABIII  3.11      4</span>
<span class="co">#&gt; 12 Egypt   ABIII  2.88      3</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">'vignettes'</span>, <span class="st">'arabb-comparison-chart.png'</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="arabb-comparison-chart.png" width="85%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">'vignettes'</span>, <span class="st">'arabb-comparison-country-chart.png'</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="arabb-comparison-country-chart.png" width="85%" style="display: block; margin: auto;"></p>
<p>We release the harmonized datasets with the code and the tutorial for further review and potential corrections.</p>
</div>
</div>
<div id="citations" class="section level2">
<h2 class="hasAnchor">
<a href="#citations" class="anchor"></a>Replication Data, Citations and Related work</h2>
<div id="replication-data" class="section level3">
<h3 class="hasAnchor">
<a href="#replication-data" class="anchor"></a>Replication Data</h3>
<p>The used datafiles and the metadata tables, and harmonized tables are too large to be hosted in a released R package. We deposited the results for further review and potential improvements on from <a href="https://doi.org/10.5281/zenodo.5034741">Zenodo</a>. All comments are corrections are welcome.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_ab_data</span> <span class="op">&lt;-</span> <span class="va">harmonized_ab_dataset</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span> <span class="op">(</span> id <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">unique_id_ab_english</span> <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span> <span class="op">(</span>eval_parl_num <span class="op">=</span> <span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span><span class="op">)</span>, 
          eval_parl_cat <span class="op">=</span> <span class="fu"><a href="../reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eval_parl</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"country"</span>, <span class="st">"eval_parl_num"</span>, <span class="st">"eval_parl_cat"</span>, <span class="st">"wave"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_spss.html">write_sav</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">harmonized_ab_data</span>, 
                 <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"arabb"</span>, <span class="st">"harmonized_arabb_waves.sav"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">harmonized_ab_data</span>,  
          <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"arabb"</span>, <span class="st">"harmonized_arabb_waves.csv"</span><span class="op">)</span>, 
          row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">categorical_summary</span>, 
          <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"arabb"</span>,  <span class="st">"arabb_categorical_summary.csv"</span><span class="op">)</span>, 
          row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">numeric_summary</span>, 
          <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"arabb"</span>, <span class="st">"arabb_numeric_summary.csv"</span><span class="op">)</span>, 
          row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># The metadata file contains list objects, which cannot be represented</span>
<span class="co"># in a flat csv file format.</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">arabbarometer_metadata</span>,  
        <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"arabb"</span>, <span class="st">"arabbarometer_metadata.rds"</span><span class="op">)</span>
        <span class="op">)</span>

<span class="co">## The lists of value labels are dropped from the csv output.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">arabbarometer_metadata</span> <span class="op">[</span>
  , <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span> <span class="op">(</span> <span class="va">arabbarometer_metadata</span>, <span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"list"</span><span class="op">)</span><span class="op">]</span>,  
  <span class="fu"><a href="../reference/here.html">here</a></span><span class="op">(</span><span class="st">"data-raw"</span>, <span class="st">"arabb"</span>,<span class="st">"arabb_metadata_simplified.csv"</span><span class="op">)</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Daniel Antal, &amp; Ahmed Shaibani. (2021). Replication Data for the retroharmonize R Package Case Study: Working With Arab Barometer Surveys (Version 0.1.6) [Data set]. Zenodo. <a href="https://doi.org/10.5281/zenodo.5034741">https://doi.org/10.5281/zenodo.5034741</a></p>
</div>
<div id="citing-the-data-sources" class="section level3">
<h3 class="hasAnchor">
<a href="#citing-the-data-sources" class="anchor"></a>Citing the data sources</h3>
<p>Arab Baromeeter data: cite <a href="https://www.arabbarometer.org/survey-data/data-downloads/">Arab Barometer</a>.</p>
</div>
<div id="citing-the-retroharmonize-r-package" class="section level3">
<h3 class="hasAnchor">
<a href="#citing-the-retroharmonize-r-package" class="anchor"></a>Citing the retroharmonize R package</h3>
<p>For main developer and contributors, see the <a href="https://retroharmonize.dataobservatory.eu/">package</a> homepage.</p>
<p>This work can be freely used, modified and distributed under the GPL-3 license:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span><span class="op">(</span><span class="st">"retroharmonize"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; To cite package 'retroharmonize' in publications use:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Daniel Antal (2021). retroharmonize: Ex Post Survey Data</span>
<span class="co">#&gt;   Harmonization. R package version 0.1.17.</span>
<span class="co">#&gt;   https://retroharmonize.dataobservatory.eu/</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; A BibTeX entry for LaTeX users is</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   @Manual{,</span>
<span class="co">#&gt;     title = {retroharmonize: Ex Post Survey Data Harmonization},</span>
<span class="co">#&gt;     author = {Daniel Antal},</span>
<span class="co">#&gt;     year = {2021},</span>
<span class="co">#&gt;     note = {R package version 0.1.17},</span>
<span class="co">#&gt;     url = {https://retroharmonize.dataobservatory.eu/},</span>
<span class="co">#&gt;   }</span></code></pre></div>
</div>
<div id="contact" class="section level3">
<h3 class="hasAnchor">
<a href="#contact" class="anchor"></a>Contact</h3>
<p>For contact information, see the <a href="https://retroharmonize.dataobservatory.eu/">package</a> homepage.</p>
</div>
<div id="version-info" class="section level3">
<h3 class="hasAnchor">
<a href="#version-info" class="anchor"></a>Version info</h3>
<p>Daniel Antal, &amp; Ahmed Shaibani. (2021, June 26). Case Study: Working With Arab Barometer Surveys for the retroharmonize R package (Version 0.1.6). Zenodo. <a href="https://doi.org/10.5281/zenodo.5034759">https://doi.org/10.5281/zenodo.5034759</a></p>
<p>This tutorial was created in the following environment, and can be downloaded in PDF format from <a href="https://doi.org/10.5281/zenodo.5034759">10.5281/zenodo.5034759</a>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.0 (2021-05-18)</span>
<span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">#&gt; Running under: Windows 10 x64 (build 17763)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] LC_COLLATE=English_United States.1252 </span>
<span class="co">#&gt; [2] LC_CTYPE=English_United States.1252   </span>
<span class="co">#&gt; [3] LC_MONETARY=English_United States.1252</span>
<span class="co">#&gt; [4] LC_NUMERIC=C                          </span>
<span class="co">#&gt; [5] LC_TIME=English_United States.1252    </span>
<span class="co">#&gt; system code page: 1250</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] snakecase_0.11.0      knitr_1.33            ggplot2_3.3.5        </span>
<span class="co">#&gt; [4] tidyr_1.1.3           dplyr_1.0.7           retroharmonize_0.1.17</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] tidyselect_1.1.1  xfun_0.24         bslib_0.2.5.1     purrr_0.3.4      </span>
<span class="co">#&gt;  [5] haven_2.4.1       labelled_2.8.0    colorspace_2.0-2  vctrs_0.3.8      </span>
<span class="co">#&gt;  [9] generics_0.1.0    htmltools_0.5.1.1 yaml_2.2.1        utf8_1.2.1       </span>
<span class="co">#&gt; [13] rlang_0.4.11      pkgdown_1.6.1     jquerylib_0.1.4   pillar_1.6.1     </span>
<span class="co">#&gt; [17] glue_1.4.2        withr_2.4.2       DBI_1.1.1         lifecycle_1.0.0  </span>
<span class="co">#&gt; [21] stringr_1.4.0     munsell_0.5.0     gtable_0.3.0      ragg_1.1.3       </span>
<span class="co">#&gt; [25] memoise_2.0.0     evaluate_0.14     forcats_0.5.1     fastmap_1.1.0    </span>
<span class="co">#&gt; [29] ps_1.6.0          fansi_0.5.0       highr_0.9         scales_1.1.1     </span>
<span class="co">#&gt; [33] cachem_1.0.5      desc_1.3.0        jsonlite_1.7.2    systemfonts_1.0.2</span>
<span class="co">#&gt; [37] fs_1.5.0          textshaping_0.3.5 hms_1.1.0         png_0.1-7        </span>
<span class="co">#&gt; [41] digest_0.6.27     stringi_1.6.2     rprojroot_2.0.2   grid_4.1.0       </span>
<span class="co">#&gt; [45] cli_2.5.0         here_1.0.1        tools_4.1.0       magrittr_2.0.1   </span>
<span class="co">#&gt; [49] sass_0.4.0        tibble_3.1.2      crayon_1.4.1      pkgconfig_2.0.3  </span>
<span class="co">#&gt; [53] ellipsis_0.3.2    rstudioapi_0.13   assertthat_0.2.1  rmarkdown_2.9    </span>
<span class="co">#&gt; [57] R6_2.5.0          compiler_4.1.0</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
