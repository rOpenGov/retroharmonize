<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case Study: Working With Eurobarometer • retroharmonize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Case Study: Working With Eurobarometer">
<meta property="og:description" content="retroharmonize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">retroharmonize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/afrobarometer.html">Case Study: Working With Afrobarometer</a>
    </li>
    <li>
      <a href="../articles/eurobarometer.html">Case Study: Working With Eurobarometer</a>
    </li>
    <li>
      <a href="../articles/harmonize_labels.html">Harmonize Value Labels</a>
    </li>
    <li>
      <a href="../articles/labelled_spss_survey.html">The labelled_spss_survey class</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/antaldaniel/retroharmonize/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="eurobarometer_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Case Study: Working With Eurobarometer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antaldaniel/retroharmonize/blob/master/vignettes/eurobarometer.Rmd"><code>vignettes/eurobarometer.Rmd</code></a></small>
      <div class="hidden name"><code>eurobarometer.Rmd</code></div>

    </div>

    
    
<p>In the <a href="http://retroharmonize.satellitereport.com/articles/afrobarometer.html">Afrobaromter Case Study</a> we have shown how to merge two waves of a survey with a limited number of variables. This workflow is not feasible with Eurobarometer on a PC or laptop, because there are too many large files to handle.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">retroharmonize</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
<p>We have created a helper function <code>subset_save_survey()</code> that programmatically reads in SPSS files, makes the necessary type conversion to <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> without harmonization, and saves a small, subsetted <code>rds</code> file. Because this is a native R file, it is far more efficient to handle in the actual workflow.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># To replicate the worklist, you need to have the SPSS file names </span>
<span class="co"># as a list, and you have to set up your own import and export path.</span>

<span class="fu"><a href="../reference/subset_save_surveys.html">subset_save_surveys</a></span> (
  <span class="kw">survey_list</span> <span class="kw">=</span> <span class="no">eb_metadata</span>,
  <span class="kw">selection_name</span> <span class="kw">=</span> <span class="st">"trust"</span>,
  <span class="kw">import_path</span> <span class="kw">=</span> <span class="no">gesis_dir</span>,
  <span class="kw">export_path</span> <span class="kw">=</span> <span class="st">"working"</span> )</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">eurobarometer_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"working"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"working"</span>))
<span class="no">eb_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span>(<span class="no">eurobarometer_waves</span>, <span class="kw">.f</span><span class="kw">=</span><span class="st">'read_rds'</span>)</pre></body></html></div>
<p>We can review if the main descriptive metadata is correctly present with <code><a href="../reference/document_waves.html">document_waves()</a></code>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">documented_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/document_waves.html">document_waves</a></span> (<span class="no">eb_waves</span>)
<span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="st">"Wave list: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">documented_waves</span>, <span class="st">"original_list"</span>))
<span class="co">#&gt; Wave list: eb_waves</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">documented_waves</span>)
<span class="co">#&gt; # A tibble: 9 x 5</span>
<span class="co">#&gt;   id           filename          ncol  nrow object_size</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 ZA2828_trust ZA2828_trust.rds     7 65178     8881288</span>
<span class="co">#&gt; 2 ZA3171_trust ZA3171_trust.rds    14 16179     3150696</span>
<span class="co">#&gt; 3 ZA3639_trust ZA3639_trust.rds    14 16012     3116544</span>
<span class="co">#&gt; 4 ZA4414_trust ZA4414_trust.rds    14 29430     5693504</span>
<span class="co">#&gt; 5 ZA4744_trust ZA4744_trust.rds    14 30170     5833760</span>
<span class="co">#&gt; 6 ZA5481_trust ZA5481_trust.rds    10 31769     5109472</span>
<span class="co">#&gt; 7 ZA5913_trust ZA5913_trust.rds    10 27932     4494592</span>
<span class="co">#&gt; 8 ZA6863_trust ZA6863_trust.rds    14 33180     6411712</span>
<span class="co">#&gt; 9 ZA7562_trust ZA7562_trust.rds     8 27524     3980296</span></pre></body></html></div>
<div id="metadata-map" class="section level2">
<h2 class="hasAnchor">
<a href="#metadata-map" class="anchor"></a>Metadata map</h2>
<p>Let’s analyze the metadata of each survey file.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">eb_trust_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> ( <span class="kw">X</span> <span class="kw">=</span> <span class="no">eb_waves</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="no">metadata_create</span>   )
<span class="no">eb_trust_metadata</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="no">eb_trust_metadata</span>)</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">eb_trust_metadata</span>)
<span class="co">#&gt;           filename           id             var_name_orig</span>
<span class="co">#&gt; 1 ZA2828_trust.rds ZA2828_trust                     rowid</span>
<span class="co">#&gt; 2 ZA2828_trust.rds ZA2828_trust                country_id</span>
<span class="co">#&gt; 3 ZA2828_trust.rds ZA2828_trust          weight_poststrat</span>
<span class="co">#&gt; 4 ZA2828_trust.rds ZA2828_trust trust_european_commission</span>
<span class="co">#&gt; 5 ZA2828_trust.rds ZA2828_trust trust_national_government</span>
<span class="co">#&gt; 6 ZA2828_trust.rds ZA2828_trust trust_european_parliament</span>
<span class="co">#&gt;                            class_orig</span>
<span class="co">#&gt; 1                           character</span>
<span class="co">#&gt; 2                           character</span>
<span class="co">#&gt; 3                             numeric</span>
<span class="co">#&gt; 4 retroharmonize_labelled_spss_survey</span>
<span class="co">#&gt; 5 retroharmonize_labelled_spss_survey</span>
<span class="co">#&gt; 6 retroharmonize_labelled_spss_survey</span>
<span class="co">#&gt;                                             label_orig  labels valid_labels</span>
<span class="co">#&gt; 1                    unique identifier in za2828_trust      NA           NA</span>
<span class="co">#&gt; 2 nation all samples iso 3166 crosstabulation variable      NA           NA</span>
<span class="co">#&gt; 3                            weight result from target      NA           NA</span>
<span class="co">#&gt; 4                          rely on european commission 1, 2, 3         1, 2</span>
<span class="co">#&gt; 5                          rely on national government 1, 2, 3         1, 2</span>
<span class="co">#&gt; 6                          rely on european parliament 1, 2, 3         1, 2</span>
<span class="co">#&gt;   na_labels na_range n_labels n_valid_labels n_na_labels</span>
<span class="co">#&gt; 1        NA       NA        0              0           0</span>
<span class="co">#&gt; 2        NA       NA        0              0           0</span>
<span class="co">#&gt; 3        NA       NA        0              0           0</span>
<span class="co">#&gt; 4         3       NA        3              2           1</span>
<span class="co">#&gt; 5         3       NA        3              2           1</span>
<span class="co">#&gt; 6         3       NA        3              2           1</span></pre></body></html></div>
<p>The value labels in this example are not too numerous. The only variable that stands out is the <code>Can rely on</code> and <code>Cannot rely on</code> labelled variable.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/collect_val_labels.html">collect_val_labels</a></span>(<span class="no">eb_trust_metadata</span>)
<span class="co">#&gt; [1] "CAN RELY ON IT"    "CANNOT RELY ON IT" "Tend to trust"    </span>
<span class="co">#&gt; [4] "Tend not to trust" "DK"</span></pre></body></html></div>
<p>And the labels that were marked by GESIS as missing values:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/collect_val_labels.html">collect_na_labels</a></span>(<span class="no">eb_trust_metadata</span>)
<span class="co">#&gt; [1] "DK"                         "NA"                        </span>
<span class="co">#&gt; [3] "Inap. (33 in V6)"           "Inap. (CY-TCC in isocntry)"</span></pre></body></html></div>
</div>
<div id="harmonize-the-labels" class="section level2">
<h2 class="hasAnchor">
<a href="#harmonize-the-labels" class="anchor"></a>Harmonize the labels</h2>
<p>For easier looping we adopt the <code><a href="../reference/harmonize_values.html">harmonize_values()</a></code> function with new default settings. It would be tempting to preserve the <code>rely</code> labels, but if we use the same numeric coding, it will lead to confusion. If you want to keep the difference of the two type of category labels, than the harmonization should be done in a two-step process.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">harmonize_eb_trust</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="no">label_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"^tend\\snot"</span>, <span class="st">"^cannot"</span>, <span class="st">"^tend\\sto"</span>, <span class="st">"^can\\srely"</span>,
             <span class="st">"^dk"</span>, <span class="st">"^inap"</span>, <span class="st">"na"</span>),
    <span class="kw">to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"not_trust"</span>, <span class="st">"not_trust"</span>, <span class="st">"trust"</span>, <span class="st">"trust"</span>,
           <span class="st">"do_not_know"</span>, <span class="st">"inap"</span>, <span class="st">"inap"</span>),
    <span class="kw">numeric_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>, <span class="fl">99997</span>,<span class="fl">99999</span>,<span class="fl">99999</span>)
  )

  <span class="fu"><a href="../reference/harmonize_values.html">harmonize_values</a></span>(<span class="no">x</span>,
                   <span class="kw">harmonize_labels</span> <span class="kw">=</span> <span class="no">label_list</span>,
                   <span class="kw">na_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"do_not_know"</span><span class="kw">=</span><span class="fl">99997</span>,
                                 <span class="st">"declined"</span><span class="kw">=</span><span class="fl">99998</span>,
                                 <span class="st">"inap"</span><span class="kw">=</span><span class="fl">99999</span>)
  )
}</pre></body></html></div>
<p>Let’s see if things did work out fine:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/document_waves.html">document_waves</a></span>(<span class="no">eb_waves</span>)
<span class="co">#&gt; # A tibble: 9 x 5</span>
<span class="co">#&gt;   id           filename          ncol  nrow object_size</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;            &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 ZA2828_trust ZA2828_trust.rds     7 65178     8881288</span>
<span class="co">#&gt; 2 ZA3171_trust ZA3171_trust.rds    14 16179     3150696</span>
<span class="co">#&gt; 3 ZA3639_trust ZA3639_trust.rds    14 16012     3116544</span>
<span class="co">#&gt; 4 ZA4414_trust ZA4414_trust.rds    14 29430     5693504</span>
<span class="co">#&gt; 5 ZA4744_trust ZA4744_trust.rds    14 30170     5833760</span>
<span class="co">#&gt; 6 ZA5481_trust ZA5481_trust.rds    10 31769     5109472</span>
<span class="co">#&gt; 7 ZA5913_trust ZA5913_trust.rds    10 27932     4494592</span>
<span class="co">#&gt; 8 ZA6863_trust ZA6863_trust.rds    14 33180     6411712</span>
<span class="co">#&gt; 9 ZA7562_trust ZA7562_trust.rds     8 27524     3980296</span></pre></body></html></div>
<p>To review the harmonization on a single survey use <code><a href="../reference/pull_survey.html">pull_survey()</a></code>. Before running our adapted harmonization function, we have this:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">test_trust</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pull_survey.html">pull_survey</a></span>(<span class="no">eb_waves</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="st">"ZA4414_trust.rds"</span>)
<span class="no">test_trust</span>$<span class="no">trust_european_commission</span>[<span class="fl">1</span>:<span class="fl">16</span>]
<span class="co">#&gt;  [1] 3 1 2 3 1 2 2 2 1 3 1 1 1 1 1 1</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;     Tend to trust Tend not to trust                DK </span>
<span class="co">#&gt;                 1                 2                 3 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "QA27 EUROPEAN COMMISSION - TRUST"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; attr(,"ZA4414_name")</span>
<span class="co">#&gt; [1] "v213"</span>
<span class="co">#&gt; attr(,"ZA4414_values")</span>
<span class="co">#&gt; 1 2 3 </span>
<span class="co">#&gt; 1 2 3 </span>
<span class="co">#&gt; attr(,"ZA4414_label")</span>
<span class="co">#&gt; [1] "QA27 EUROPEAN COMMISSION - TRUST"</span>
<span class="co">#&gt; attr(,"ZA4414_labels")</span>
<span class="co">#&gt;     Tend to trust Tend not to trust                DK </span>
<span class="co">#&gt;                 1                 2                 3 </span>
<span class="co">#&gt; attr(,"ZA4414_na_values")</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "ZA4414"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"</span></pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu">harmonize_eb_trust</span>(<span class="no">test_trust</span>$<span class="no">trust_european_commission</span>[<span class="fl">1</span>:<span class="fl">16</span>])
<span class="co">#&gt;  [1] 99997     1     0 99997     1     0     0     0     1 99997     1     1</span>
<span class="co">#&gt; [13]     1     1     1     1</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;   not_trust       trust do_not_know    declined        inap </span>
<span class="co">#&gt;           0           1       99997       99998       99999 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "QA27 EUROPEAN COMMISSION - TRUST"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 99997 99998 99999</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"survey_id_name")</span>
<span class="co">#&gt; [1] "x"</span>
<span class="co">#&gt; attr(,"survey_id_values")</span>
<span class="co">#&gt;     2     1     3 </span>
<span class="co">#&gt;     0     1 99997 </span>
<span class="co">#&gt; attr(,"survey_id_label")</span>
<span class="co">#&gt; [1] "QA27 EUROPEAN COMMISSION - TRUST"</span>
<span class="co">#&gt; attr(,"survey_id_labels")</span>
<span class="co">#&gt;     Tend to trust Tend not to trust                DK </span>
<span class="co">#&gt;                 1                 2                 3 </span>
<span class="co">#&gt; attr(,"survey_id_na_values")</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey_id"</span></pre></body></html></div>
<p>If you are satisfied with the results, run <code>harmonize_eb_trust``()</code> through the 9 survey waves. Whenever a variable is missing from a wave, it is filled up with <code>inapproriate</code> missing values.</p>
</div>
<div id="harmonize-waves" class="section level2">
<h2 class="hasAnchor">
<a href="#harmonize-waves" class="anchor"></a>Harmonize waves</h2>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">harmonized_eb_waves</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/harmonize_waves.html">harmonize_waves</a></span> ( <span class="kw">waves</span> <span class="kw">=</span> <span class="no">eb_waves</span>,
                                      <span class="kw">.f</span> <span class="kw">=</span> <span class="no">harmonize_eb_trust</span> )</pre></body></html></div>
<p>We cannot rely on <code><a href="../reference/document_waves.html">document_waves()</a></code> anymore, because the result is a single data frame. Let’s have a look at the descriptive metadata.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">wave_attributes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">harmonized_eb_waves</span>)
<span class="no">wave_attributes</span>$<span class="no">id</span>
<span class="co">#&gt; [1] "Waves: ZA2828_trust; ZA3171_trust; ZA3639_trust; ZA4414_trust; ZA4744_trust; ZA5481_trust; ZA5913_trust; ZA6863_trust; ZA7562_trust"</span>
<span class="no">wave_attributes</span>$<span class="no">filename</span>
<span class="co">#&gt; [1] "Original files: ZA2828_trust.rds; ZA3171_trust.rds; ZA3639_trust.rds; ZA4414_trust.rds; ZA4744_trust.rds; ZA5481_trust.rds; ZA5913_trust.rds; ZA6863_trust.rds; ZA7562_trust.rds"</span>
<span class="no">wave_attributes</span>$<span class="no">names</span>
<span class="co">#&gt;  [1] "rowid"                     "country_id"               </span>
<span class="co">#&gt;  [3] "weight_poststrat"          "weight_extrapolated"      </span>
<span class="co">#&gt;  [5] "trust_european_commission" "trust_national_government"</span>
<span class="co">#&gt;  [7] "trust_european_parliament" "trust_national_parliament"</span>
<span class="co">#&gt;  [9] "trust_justice_system"      "trust_police"             </span>
<span class="co">#&gt; [11] "trust_army"                "trust_political_parties"  </span>
<span class="co">#&gt; [13] "trust_companies"           "trust_european_union"     </span>
<span class="co">#&gt; [15] "trust_united_nations"</span></pre></body></html></div>
<p>Let’s review a bit the results:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">ZA2828</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pull_survey.html">pull_survey</a></span>(<span class="no">eb_waves</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="st">"ZA2828_trust"</span>)
<span class="fu"><a href="../reference/document_survey_item.html">document_survey_item</a></span>(<span class="no">ZA2828</span>$<span class="no">trust_national_government</span>)
<span class="co">#&gt; $code_table</span>
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   values ZA2828_values labels            ZA2828_labels     missing</span>
<span class="co">#&gt;    &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;             &lt;lgl&gt;  </span>
<span class="co">#&gt; 1      1             1 CAN RELY ON IT    CAN RELY ON IT    FALSE  </span>
<span class="co">#&gt; 2      2             2 CANNOT RELY ON IT CANNOT RELY ON IT FALSE  </span>
<span class="co">#&gt; 3      3             3 DK                DK                TRUE   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_var_name</span>
<span class="co">#&gt;                               name                        ZA2828_name </span>
<span class="co">#&gt; "ZA2828$trust_national_government"                             "v468" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_var_label</span>
<span class="co">#&gt;                              label                       ZA2828_label </span>
<span class="co">#&gt; "Q39B RELY ON NATIONAL GOVERNMENT" "Q39B RELY ON NATIONAL GOVERNMENT" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_na_range</span>
<span class="co">#&gt; character(0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_id</span>
<span class="co">#&gt; [1] "ZA2828"</span></pre></body></html></div>
</div>
<div id="analyze-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#analyze-the-data" class="anchor"></a>Analyze the data</h2>
<p>If you did not save your work to use for another statistical software, from now on you can analyze the harmonized data in R. The labelled survey data is stored in <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> vectors, which is a complex class that retains much metadata for reproducibility. Most statistical R packages do not know it. The data should be presented either as numeric data with <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code> or as categorical with <code><a href="../reference/as_factor.html">as_factor()</a></code>. (See more why you should not fall back on the more generic <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> or <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> methods in <a href="http://retroharmonize.satellitereport.com/articles/labelled_spss_survey.html">The labelled_spss_survey class vignette.</a>)</p>
<p>If there is a <code>99901</code> value, it refers to an invalid observation. The missing value range is not correctly identified. It should be made sure that if there is an unrecognized category label it goes into the missing range (and is marked that it was not recognized.)</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">harmonized_eb_waves</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), <span class="no">as_factor</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()
<span class="co">#&gt;     rowid            country_id        weight_poststrat weight_extrapolated</span>
<span class="co">#&gt;  Length:277374      Length:277374      Min.   :0.0095   Min.   :   140.8   </span>
<span class="co">#&gt;  Class :character   Class :character   1st Qu.:0.7471   1st Qu.:  2674.3   </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Median :0.9451   Median :  6695.4   </span>
<span class="co">#&gt;                                        Mean   :1.0000   Mean   : 15015.7   </span>
<span class="co">#&gt;                                        3rd Qu.:1.1763   3rd Qu.: 18032.9   </span>
<span class="co">#&gt;                                        Max.   :6.9678   Max.   :171193.5   </span>
<span class="co">#&gt;                                                         NA's   :126799     </span>
<span class="co">#&gt;  trust_european_commission trust_national_government trust_european_parliament</span>
<span class="co">#&gt;  not_trust  : 87687        not_trust  :149351        not_trust  : 86910       </span>
<span class="co">#&gt;  trust      :109047        trust      :105644        trust      :117200       </span>
<span class="co">#&gt;  do_not_know: 53106        do_not_know: 20856        do_not_know: 45727       </span>
<span class="co">#&gt;  declined   :     0        declined   :     0        declined   :     0       </span>
<span class="co">#&gt;  inap       : 27534        inap       :  1523        inap       : 27537       </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;                                                                               </span>
<span class="co">#&gt;  trust_national_parliament  trust_justice_system      trust_police   </span>
<span class="co">#&gt;  not_trust  :144288        not_trust  : 55727    not_trust  : 39423  </span>
<span class="co">#&gt;  trust      :107434        trust      : 59928    trust      : 78946  </span>
<span class="co">#&gt;  do_not_know: 24133        do_not_know:  8305    do_not_know:  6088  </span>
<span class="co">#&gt;  declined   :     0        declined   :     0    declined   :     0  </span>
<span class="co">#&gt;  inap       :  1519        inap       :153414    inap       :152917  </span>
<span class="co">#&gt;                                                                      </span>
<span class="co">#&gt;                                                                      </span>
<span class="co">#&gt;        trust_army     trust_political_parties    trust_companies  </span>
<span class="co">#&gt;  not_trust  : 27338   not_trust  :132638      not_trust  : 31669  </span>
<span class="co">#&gt;  trust      : 84711   trust      : 35656      trust      : 21416  </span>
<span class="co">#&gt;  do_not_know: 11904   do_not_know: 11614      do_not_know:  8509  </span>
<span class="co">#&gt;  declined   :     0   declined   :     0      declined   :     0  </span>
<span class="co">#&gt;  inap       :153421   inap       : 97466      inap       :215780  </span>
<span class="co">#&gt;                                                                   </span>
<span class="co">#&gt;                                                                   </span>
<span class="co">#&gt;   trust_european_union  trust_united_nations</span>
<span class="co">#&gt;  not_trust  :90665     not_trust  : 50559   </span>
<span class="co">#&gt;  trust      :95971     trust      : 81663   </span>
<span class="co">#&gt;  do_not_know:25039     do_not_know: 23996   </span>
<span class="co">#&gt;  declined   :    0     declined   :     0   </span>
<span class="co">#&gt;  inap       :65699     inap       :121156   </span>
<span class="co">#&gt;                                             </span>
<span class="co">#&gt; </span></pre></body></html></div>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">numeric_harmonization</span> <span class="kw">&lt;-</span> <span class="no">harmonized_eb_waves</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), <span class="no">as_numeric</span> )
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">numeric_harmonization</span>)
<span class="co">#&gt;     rowid            country_id        weight_poststrat weight_extrapolated</span>
<span class="co">#&gt;  Length:277374      Length:277374      Min.   :0.0095   Min.   :   140.8   </span>
<span class="co">#&gt;  Class :character   Class :character   1st Qu.:0.7471   1st Qu.:  2674.3   </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Median :0.9451   Median :  6695.4   </span>
<span class="co">#&gt;                                        Mean   :1.0000   Mean   : 15015.7   </span>
<span class="co">#&gt;                                        3rd Qu.:1.1763   3rd Qu.: 18032.9   </span>
<span class="co">#&gt;                                        Max.   :6.9678   Max.   :171193.5   </span>
<span class="co">#&gt;                                                         NA's   :126799     </span>
<span class="co">#&gt;  trust_european_commission trust_national_government trust_european_parliament</span>
<span class="co">#&gt;  Min.   :0.00              Min.   :0.000             Min.   :0.00             </span>
<span class="co">#&gt;  1st Qu.:0.00              1st Qu.:0.000             1st Qu.:0.00             </span>
<span class="co">#&gt;  Median :1.00              Median :0.000             Median :1.00             </span>
<span class="co">#&gt;  Mean   :0.55              Mean   :0.414             Mean   :0.57             </span>
<span class="co">#&gt;  3rd Qu.:1.00              3rd Qu.:1.000             3rd Qu.:1.00             </span>
<span class="co">#&gt;  Max.   :1.00              Max.   :1.000             Max.   :1.00             </span>
<span class="co">#&gt;  NA's   :80640             NA's   :22379             NA's   :73264            </span>
<span class="co">#&gt;  trust_national_parliament trust_justice_system  trust_police   </span>
<span class="co">#&gt;  Min.   :0.000             Min.   :0.00         Min.   :0.00    </span>
<span class="co">#&gt;  1st Qu.:0.000             1st Qu.:0.00         1st Qu.:0.00    </span>
<span class="co">#&gt;  Median :0.000             Median :1.00         Median :1.00    </span>
<span class="co">#&gt;  Mean   :0.427             Mean   :0.52         Mean   :0.67    </span>
<span class="co">#&gt;  3rd Qu.:1.000             3rd Qu.:1.00         3rd Qu.:1.00    </span>
<span class="co">#&gt;  Max.   :1.000             Max.   :1.00         Max.   :1.00    </span>
<span class="co">#&gt;  NA's   :25652             NA's   :161719       NA's   :159005  </span>
<span class="co">#&gt;    trust_army     trust_political_parties trust_companies  trust_european_union</span>
<span class="co">#&gt;  Min.   :0.00     Min.   :0.00            Min.   :0.0      Min.   :0.00        </span>
<span class="co">#&gt;  1st Qu.:1.00     1st Qu.:0.00            1st Qu.:0.0      1st Qu.:0.00        </span>
<span class="co">#&gt;  Median :1.00     Median :0.00            Median :0.0      Median :1.00        </span>
<span class="co">#&gt;  Mean   :0.76     Mean   :0.21            Mean   :0.4      Mean   :0.51        </span>
<span class="co">#&gt;  3rd Qu.:1.00     3rd Qu.:0.00            3rd Qu.:1.0      3rd Qu.:1.00        </span>
<span class="co">#&gt;  Max.   :1.00     Max.   :1.00            Max.   :1.0      Max.   :1.00        </span>
<span class="co">#&gt;  NA's   :165325   NA's   :109080          NA's   :224289   NA's   :90738       </span>
<span class="co">#&gt;  trust_united_nations</span>
<span class="co">#&gt;  Min.   :0.00        </span>
<span class="co">#&gt;  1st Qu.:0.00        </span>
<span class="co">#&gt;  Median :1.00        </span>
<span class="co">#&gt;  Mean   :0.62        </span>
<span class="co">#&gt;  3rd Qu.:1.00        </span>
<span class="co">#&gt;  Max.   :1.00        </span>
<span class="co">#&gt;  NA's   :145152</span></pre></body></html></div>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">harmonized_eb_waves</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), <span class="no">as_numeric</span> ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span> ( <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trust"</span>)), ~<span class="no">.</span>*<span class="no">weight_poststrat</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>()
<span class="co">#&gt;     rowid            country_id        weight_poststrat weight_extrapolated</span>
<span class="co">#&gt;  Length:277374      Length:277374      Min.   :0.0095   Min.   :   140.8   </span>
<span class="co">#&gt;  Class :character   Class :character   1st Qu.:0.7471   1st Qu.:  2674.3   </span>
<span class="co">#&gt;  Mode  :character   Mode  :character   Median :0.9451   Median :  6695.4   </span>
<span class="co">#&gt;                                        Mean   :1.0000   Mean   : 15015.7   </span>
<span class="co">#&gt;                                        3rd Qu.:1.1763   3rd Qu.: 18032.9   </span>
<span class="co">#&gt;                                        Max.   :6.9678   Max.   :171193.5   </span>
<span class="co">#&gt;                                                         NA's   :126799     </span>
<span class="co">#&gt;  trust_european_commission trust_national_government trust_european_parliament</span>
<span class="co">#&gt;  Min.   :0.00              Min.   :0.000             Min.   :0.00             </span>
<span class="co">#&gt;  1st Qu.:0.00              1st Qu.:0.000             1st Qu.:0.00             </span>
<span class="co">#&gt;  Median :0.58              Median :0.000             Median :0.63             </span>
<span class="co">#&gt;  Mean   :0.56              Mean   :0.413             Mean   :0.58             </span>
<span class="co">#&gt;  3rd Qu.:0.99              3rd Qu.:0.853             3rd Qu.:1.00             </span>
<span class="co">#&gt;  Max.   :6.43              Max.   :6.732             Max.   :6.43             </span>
<span class="co">#&gt;  NA's   :80640             NA's   :22379             NA's   :73264            </span>
<span class="co">#&gt;  trust_national_parliament trust_justice_system  trust_police   </span>
<span class="co">#&gt;  Min.   :0.000             Min.   :0.00         Min.   :0.00    </span>
<span class="co">#&gt;  1st Qu.:0.000             1st Qu.:0.00         1st Qu.:0.00    </span>
<span class="co">#&gt;  Median :0.000             Median :0.46         Median :0.75    </span>
<span class="co">#&gt;  Mean   :0.427             Mean   :0.52         Mean   :0.67    </span>
<span class="co">#&gt;  3rd Qu.:0.870             3rd Qu.:0.95         3rd Qu.:1.03    </span>
<span class="co">#&gt;  Max.   :6.732             Max.   :5.58         Max.   :6.97    </span>
<span class="co">#&gt;  NA's   :25652             NA's   :161719       NA's   :159005  </span>
<span class="co">#&gt;    trust_army     trust_political_parties trust_companies  trust_european_union</span>
<span class="co">#&gt;  Min.   :0.00     Min.   :0.00            Min.   :0.00     Min.   :0.00        </span>
<span class="co">#&gt;  1st Qu.:0.34     1st Qu.:0.00            1st Qu.:0.00     1st Qu.:0.00        </span>
<span class="co">#&gt;  Median :0.82     Median :0.00            Median :0.00     Median :0.43        </span>
<span class="co">#&gt;  Mean   :0.76     Mean   :0.21            Mean   :0.41     Mean   :0.52        </span>
<span class="co">#&gt;  3rd Qu.:1.07     3rd Qu.:0.00            3rd Qu.:0.88     3rd Qu.:0.96        </span>
<span class="co">#&gt;  Max.   :6.97     Max.   :4.77            Max.   :6.97     Max.   :6.97        </span>
<span class="co">#&gt;  NA's   :165325   NA's   :109080          NA's   :224289   NA's   :90738       </span>
<span class="co">#&gt;  trust_united_nations</span>
<span class="co">#&gt;  Min.   :0.00        </span>
<span class="co">#&gt;  1st Qu.:0.00        </span>
<span class="co">#&gt;  Median :0.72        </span>
<span class="co">#&gt;  Mean   :0.62        </span>
<span class="co">#&gt;  3rd Qu.:1.02        </span>
<span class="co">#&gt;  Max.   :6.97        </span>
<span class="co">#&gt;  NA's   :145152</span></pre></body></html></div>
<p>We have a problem: the invalid values should go out to the missing range, but they are not always correctly labelled as missing. The names in the tibble should also be fixed.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">numeric_harmonization</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">country_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_if</a></span> ( <span class="no">is.numeric</span>, <span class="no">mean</span>, <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 38 x 14</span>
<span class="co">#&gt;    country_id weight_poststrat weight_extrapol~ trust_european_~</span>
<span class="co">#&gt;    &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt;  1 AL                     1.00            2051.            0.765</span>
<span class="co">#&gt;  2 AT                     1.00            7176.            0.472</span>
<span class="co">#&gt;  3 BE                     1.00            9043.            0.605</span>
<span class="co">#&gt;  4 BG                     1.00            6450.            0.685</span>
<span class="co">#&gt;  5 CY                     1.00            1389.            0.565</span>
<span class="co">#&gt;  6 CY-TCC                 1.00             286.            0.660</span>
<span class="co">#&gt;  7 CZ                     1.00            8797.            0.505</span>
<span class="co">#&gt;  8 DE-E                   1.00           25578.            0.390</span>
<span class="co">#&gt;  9 DE-W                   1.00           51896.            0.425</span>
<span class="co">#&gt; 10 DK                     1.00            4603.            0.533</span>
<span class="co">#&gt; # ... with 28 more rows, and 10 more variables:</span>
<span class="co">#&gt; #   trust_national_government &lt;dbl&gt;, trust_european_parliament &lt;dbl&gt;,</span>
<span class="co">#&gt; #   trust_national_parliament &lt;dbl&gt;, trust_justice_system &lt;dbl&gt;,</span>
<span class="co">#&gt; #   trust_police &lt;dbl&gt;, trust_army &lt;dbl&gt;, trust_political_parties &lt;dbl&gt;,</span>
<span class="co">#&gt; #   trust_companies &lt;dbl&gt;, trust_european_union &lt;dbl&gt;,</span>
<span class="co">#&gt; #   trust_united_nations &lt;dbl&gt;</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Antal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
